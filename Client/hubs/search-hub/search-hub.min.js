var th=th||{};th.next=th.next||{};
th.next.SearchHub=function(d){function g(){a=this;this.cssClassHub=".search-hub";this.searchPanel=this.searchTemplate=this.scanTimerId=null;this.hubStatus=statusHub.not_active;this.userPerClick=null;this.argsDlgFilter={};this.feedbackClass=".search-hub-dlg-feedback";this.commonHub=new th.next.CommonHub(this);this.Initialize()}function q(b){try{b.preventDefault();if(13===b.keyCode)return m(),!1;var c=".3";0<b.target.value.length&&(c="1");a.btn_search.css("opacity",c);a.argsDlgFilter={};return!1}catch(d){return console.log("ERROR(SearchHub.onTextSearch_Enter()): "+
d),!1}}function v(b){try{b.preventDefault();a.userPerClick=getUserPerDataTemplate("search-list-view-item-template",b);var c=b.target,d=c.getAttribute("data-action"),l=c.getAttribute("data-action-dlg"),h="."+c.getAttribute("data-template-dlg");if("friends"===d){if(a.userPerClick.id===getUser().id)return s("You can't make friend of yourself :)"),!1;a.showProgressBar(!0);a.commonHub.getHub(ctrlPerson,"person-hub",function(b){b.init&&(ctrlPerson=new th.next.PersonController);setTimeout(function(){ctrlPerson.isPersonOfUserCallback(getUser(),
a.userPerClick,"friend",function(b){a.showProgressBar(!1);if(1===b)s("This user already in your person's list");else a.commonHub[l](a,h,function(a){})})},600)})}else a.commonHub[l](a,h,function(a){});return!1}catch(w){return console.log("ERROR(SearchHub.onUserAction_Click()): "+w),!1}}function n(b){try{b.preventDefault();var c=b.target,d=c.getAttribute("data-action"),l="."+c.getAttribute("data-dlg");b="show"+d;a.argsDlgFilter={};a.commonHub[b](a,l,function(){if("DlgPerFilter"===d&&"{}"!==JSON.stringify(a.argsDlgFilter)){var b=
"",c;for(c in a.argsDlgFilter)a.argsDlgFilter.hasOwnProperty(c)&&(b+=a.argsDlgFilter[c]+" ");b=b.trim();a.txt_search.val(b);c="1";""===b&&(c=".3");a.btn_search.css("opacity",c)}});return!1}catch(h){return console.log("ERROR[SearchHub.onSearchMainMenu_Click():] "+h),!1}}function p(a){try{return a.preventDefault(),m(),!1}catch(c){return console.log("ERROR(SearchHub.onStartSearch_Click()): "+c),k(!1),!1}}function m(){try{t(),""===a.txt_search.val()?a.commonHub.showInfoDlg(a,".search-hub-dlg-info","Hey, need arguments for search, type it or click filter button !",
function(a){}):isDefine(a.argsDlgFilter)&&"{}"!==JSON.stringify(a.argsDlgFilter)?r():x()}catch(b){console.log("ERROR(SearchHub.searchSwitch()): "+b)}}function r(){try{if(a.hubStatus!==statusHub.data_load){var b=function(b,c,d){k(!1);try{if(isJsonData(b)){var e=JSON.parse(b);if("object"===typeof e.param){var f=e.param;for(b=0;b<f.length;b++)u(b,f[b]);return}}a.commonHub.showInfoDlg(a,".search-hub-dlg-info","Oops, nobody here :(",function(a){})}catch(g){console.log("FAIL-PARSING[SearchHub->ctrlSearch.startSearch()]: "+
g),a.hubStatus=statusHub.data_loaded_err}},c=function(b,c,d){console.log("ERROR[SearchHub->ctrlSearch.startSearch()]: "+d);k(!1);a.hubStatus=statusHub.data_loaded_err};setTimeout(function(){var l={radarLocation:d(".search-hub .radar-location").val(),activeChannel:getActiveChannel(),limit:15},h;for(h in a.argsDlgFilter)if(a.argsDlgFilter.hasOwnProperty(h)){var e=a.argsDlgFilter[h];""!==e&&(l[h]=e)}ctrlSearch.startSearch("search-per-filter",l,b,c)},600);k(!0)}}catch(e){console.log("ERROR(SearchHub.searchFilterRoutine()): "+
e)}}function x(){try{if(a.hubStatus!==statusHub.data_load){var b=function(b,c,d){k(!1);try{if(isJsonData(b)){var e=JSON.parse(b);if("object"===typeof e.param){var f=e.param;for(b=0;b<f.length;b++)u(b,f[b]);return}}a.commonHub.showInfoDlg(a,".search-hub-dlg-info","Oops, nobody here :(",function(a){})}catch(g){console.log("FAIL-PARSING[SearchHub->ctrlSearch.startSearch()]: "+g),a.hubStatus=statusHub.data_loaded_err}},c=function(b,c,d){console.log("ERROR[SearchHub->ctrlSearch.startSearch()]: "+d);k(!1);
a.hubStatus=statusHub.data_loaded_err};setTimeout(function(){var e={radarLocation:d(".search-hub .radar-location").val(),activeChannel:encodeURIComponent(getActiveChannel()),txt_search:a.txt_search.val(),limit:18};ctrlSearch.startSearch("search-per-text",e,b,c)},600);k(!0)}}catch(e){console.log("ERROR(SearchHub.searchTextRoutine()): "+e)}}function y(){try{var a=d(".search-hub .radar-location"),c;for(c in searchLocation)if(searchLocation.hasOwnProperty(c)){var e=searchLocation[c],f=document.createElement("option");
f.innerHTML=e;f.value=c;a[0].appendChild(f)}}catch(h){console.log("ERROR(SearchHub.feelSelectRadarLocation()): "+h)}}function s(b){a.commonHub.showInfoDlg(a,".search-hub-dlg-info",b,function(a){})}function k(b){try{if(b)a.showProgressBar(!0),z(),t(),a.hubStatus=statusHub.data_load,a.btn_search.css("opacity",".3");else{a.showProgressBar(!1);try{clearInterval(a.scanTimerId),a.scanTimerId=null}catch(c){console.log("ERROR(SearchHub.stopScanner()): "+c)}a.searchPanel.css("display","block");a.hubStatus=
statusHub.data_loaded;a.btn_search.css("opacity","1")}}catch(d){console.log("ERROR(SearchHub.uiActivateSearch()): "+d)}}function z(){try{var b=d("#scanner"),c=0;(function h(){b.css({transform:"rotate("+c+"deg)"});a.scanTimerId=setTimeout(function(){++c;h()},25)})()}catch(e){console.log("ERROR(SearchHub.startScanner()): "+e)}}function u(b,c){try{if(isDefine(c)){if(!a.searchTemplate){var e=d("#search-item-template").html();a.searchTemplate=d(e)}if(0!=a.searchTemplate.length){var f=JSON.stringify(c);
d(a.searchTemplate).find(".template-data span").text(f);d(a.searchTemplate).find(".template-date span").text(c.date);var h=getStrUserShortProfile(c);d(a.searchTemplate).find(".template-text span").text(h);d(a.searchTemplate).find(".template-nick span").text(c.nick);var g=a.searchTemplate.find(".template-image");a.commonHub.setUserIcon(g,c);var k=a.searchTemplate[0].outerHTML.replace("template-item","");d("#search-list-view-ctrl").append("<li>"+k+"</li>");g[0].removeAttribute("style")}}}catch(q){console.log("ERROR(SearchHub.bindDataTemplateValues()): "+
q)}}function t(){try{d("#search-list-view-ctrl li").remove(),a.searchPanel.css("display","none")}catch(b){console.log("ERROR(SearchHub.cleanSearchPanel()): "+b)}}var a,f=g.prototype;f.Initialize=function(){try{ctrlSearch||(ctrlSearch=new th.next.SearchController);y();a.txt_search=d("#input-search-panel");a.txt_search.keyup(q);setTimeout(function(){a.txt_search.focus()},600);a.searchPanel=d(".search-hub .search-list");a.commonHub.removeMainMenuItem(a,"search");this.initHub();a.commonHub.setHubPosition(a);
d(".search-hub ul.th-ul-main-menu").css("display","none");this.hubStatus=statusHub.initialized;try{d(document).on("click",".search-hub ul.th-ul-main-menu li",n),d(document).on("click",".search-hub .th-user-actions li span",v),a.btn_search=d("#btn-search-routine"),a.btn_search.click(p),a.btn_search.css("opacity",".3")}catch(b){console.log("ERROR(SearchHub.setUIEvents()): "+b)}}catch(c){console.log("ERROR[SearchHub.Initialize()]: "+c)}};f.initHub=function(){a.commonHub.initHub(a)};f.onMainMenuAction_Click=
function(b){a.commonHub.onMainMenuAction_Click(a,b)};f.fromHubToHub=function(b,c){a.commonHub.fromHubToHub(a,b,c)};f.hubShow=function(b){a.commonHub.hubShow(a,b);a.hubStatus=a.hubStatus<statusHub.active?statusHub.active:a.hubStatus};f.hubRemove=function(){a.commonHub.hubRemove.call(this)};f.showProgressBar=function(b){a.commonHub.showProgressBar(a,b)};f.getHubStatus=function(b){return a.hubStatus};return g}(thJQ);
th.next.SearchController=function(d){function g(){this.Initialize()}d=g.prototype;d.Initialize=function(){};d.startSearch=function(d,g,n,p){try{if(isDefine(g)&&isDefine(n)&&isDefine(p)){var m=JSON.stringify(g);ajaxCall(pathServer+d,d+"="+m,n,p)}}catch(r){console.log("ERROR(SearchController.startSearch()): "+r)}};return g}(thJQ);
