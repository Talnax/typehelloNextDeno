var th=th||{};th.next=th.next||{};
th.next.LoginHub=function(e){function g(){initSocketIO();setActiveChannel(document.URL);c=this;this.cssClassHub=".login-hub";this.hubStatus=statusHub.not_active;this.elServerSide=e("#http-login-respond");this.nickName=null;this.logInComplete=!1;this.commonHub=new th.next.CommonHub(this);this.Initialize()}function q(a){try{return a.preventDefault(),window.open("http://www.typehello.com/new-terms.html"),!1}catch(b){return console.log("ERROR(LoginHub.onTerms_Click())"+b),!1}}function r(a){try{return a.preventDefault(),
alert("This document in PROGRESS :)"),!1}catch(b){return console.log("ERROR(LoginHub.onDataUsePolicy_Click())"+b),!1}}function s(a){try{return a.preventDefault(),alert("This document in PROGRESS :)"),!1}catch(b){return console.log("ERROR(LoginHub.onCookieUse_Click())"+b),!1}}function t(a){try{a.preventDefault();var b=e(this)[0].value;0!==b.length&&(3>b.length||9<b.length?alert("Oops, Length of `Nick` have to be between 3 and 9 characters !"):-1<b.indexOf(" ")?alert("Oops, `Nick` have to be without blank(' ') character !"):
c.nickName!==b&&(c.nickName=b,u(c.nickName)));return!1}catch(d){return console.log("ERROR(LoginHub.onNickName_LostFocus())"+d),!1}}function v(){try{e("#th-btn-login").click(c.onBtnLogin_Click),e("#input-login-password").keyup(function(a){if(13===a.keyCode)c.onBtnLogin_Click(a)}),c.btnSignUP.click(c.onBtnSignUp_Click),e("#th-btn-new-user").click(c.onLnkNewUser_Click),e("#sing-up-terms").click(q),e("#sign-up-data-use-policy").click(r),e("#sign-up-cookie-use").click(s),e("#input-sign-up-nick").blur(t)}catch(a){console.log("ERROR(LoginHub.setUIEvents()): "+
a)}}function m(a){try{a?(c.btnSignUP.css("opacity","1.0"),c.pnlTerms.css("opacity","1.0")):(c.btnSignUP.css("opacity","0.3"),c.pnlTerms.css("opacity","0.3"))}catch(b){console.log("ERROR(LoginHub.enableBtnSignUp())"+b)}}function n(a){try{delCookie(storageNick,""),delCookie(storagePswd,""),setCookie(storageNick,a.nick,18),setCookie(storagePswd,a.pwd,18)}catch(b){console.log("ERROR(LoginHub.setCredentials())"+b)}}function w(a){try{c.commonHub.getHub(hubTalk,"talk-hub",function(b){b.init&&(hubTalk=new th.next.TalkHub);
sendCallBack(a)})}catch(b){console.log("ERROR(LoginHub.openTalkHub())"+b)}}function p(a,b){try{c.logInComplete=!0,c.hubShow(!1),hubTalk.socketOpenChat(a),x(b),isNewUser&&setTimeout(function(){hubProfile?(hubProfile.hubShow(!0),hubProfile.showFirstTime(getUser())):loadHub("profile-hub",function(a){"ok"===a&&(hubProfile||(hubProfile=new th.next.ProfileHub),hubProfile.hubShow(!0),hubProfile.showFirstTime(getUser()))})},1500)}catch(d){console.log("ERROR(LoginHub.showTalkHub())"+d)}}function h(a){try{c.elServerSide.append(a),
c.elServerSide[0].scrollTop=c.elServerSide[0].scrollHeight}catch(b){console.log("ERROR(LoginHub.showHttpServerResponse())"+b)}}function x(a){try{e("#messages-server").append(a)}catch(b){console.log("ERROR(LoginHub.showSocketServerResponse())"+b)}}function y(a,b){try{3>a.nick.length||9<a.nick.length?(alert("`Nick` have to be between 3 and 9 characters !"),sendCallBack(b(!1))):-1<a.nick.indexOf(" ")?(alert("`Nick` have to be without blank(' ') character !"),sendCallBack(b(!1))):3>a.pwd.length||6<a.pwd.length?
(alert("`Password` have to be between 3 and 6 characters !"),sendCallBack(b(!1))):-1<a.pwd.indexOf(" ")?(alert("`Password` have to be without blank(' ') character !"),sendCallBack(b(!1))):z(a.mail,function(a){sendCallBack(b(a))})}catch(c){console.log("ERROR(LoginHub.checkAllSignUpData())"+c),sendCallBack(b(res))}}function u(a){try{var b=function(a,b,d){c.showProgressBar(!1);m(!0);isJsonData(a)?(a=JSON.parse(a),console.log(a.param),0<a.param.length&&alert("This nick already exist :(")):alert("We can't get data :(")},
d=function(a,b,d){console.log("FAIL[LoginHub.checkNickName()]"+d);c.showProgressBar(!1)};if(isDefine(a)){m(!1);var e=JSON.stringify({dbcall:"db-find",dbcollection:"users",dbrequest:{nick:a}});setTimeout(function(){ajaxCall(pathServer+"check-nick-name","check-nick-name="+e,b,d)},600);c.showProgressBar(!0)}}catch(f){console.log("ERROR(LoginHub.checkNickName())"+f),c.showProgressBar(!1)}}function z(a,b){try{var c=function(a,c,d){isJsonData(a)?0<JSON.parse(a).param.length?(alert("This eMail already exist :("),
sendCallBack(b(!1))):sendCallBack(b(!0)):sendCallBack(b(!0))},e=function(a,c,d){console.log("FAIL[LoginHub.checkEMail()]"+d);sendCallBack(b(!1))};if(isDefine(a))if(isEmailCorrect(a)){var f=JSON.stringify({dbcall:"db-find",dbcollection:"users",dbrequest:{mail:a}});setTimeout(function(){ajaxCall(pathServer+"check-email","check-email="+f,c,e)},600)}else alert("`eMail` is NOT correct !"),sendCallBack(b(!1));else alert("`eMail` is NOT correct !"),sendCallBack(b(!1))}catch(k){console.log("ERROR(LoginHub.checkEMail())"+
k),sendCallBack(b(!1))}}var c,f=g.prototype;f.Initialize=function(){try{this.initHub(),this.checkUserIdentity(),c.commonHub.setScrollHubPosition(c),c.btnSignUP=e("#btn-sign-up"),c.pnlTerms=e(".login-hub .th-sign-up .th-terms-panel"),c.pnlSignUP=e(".login-hub .th-sign-up"),v(),c.hubStatus=statusHub.initialized}catch(a){console.log("ERROR(LoginHub.Initialize())"+a)}};f.httpLogin=function(a){try{if(isDefine(a)){c.showProgressBar(!0);h("Call Server...");var b=function(a,b,c){console.log("New User Fail... "+
c);h('<li class="red-frg">New User Fail...</li>')};setTimeout(function(){var d=JSON.stringify(a);ajaxCall(pathServer+"login","login="+d,c.httpLogin_Complete,b)},600)}}catch(d){console.log("ERROR(LoginHub.httpLogin())"+d)}};f.httpLogin_Complete=function(a,b,d){try{c.showProgressBar(!1);var f=JSON.parse(a),l;if(f.err)l='<li class="red-frg">Login Fail...</li>',e(".th-standard-login").css("display","block");else{var k=f.backmessage;saveLocalStorageValues(storageNick,k.nick);setUser(k);c.socketLogin()?
l="<li>Login Completed</li>":(l='<li class="red-frg">Socket Fail...</li>',e(".th-standard-login").css("display","block"),c.showProgressBar(!1))}h(l)}catch(g){console.log("ERROR(LoginHub.httpLogin_Complete())"+g)}};f.socketLogin=function(){try{var a=getUser();isDefine(a.socket_id)||(a.channels=[],a.socket_id=null);Socket.emit(socketEvents.socket_login,{user:a});return!0}catch(b){return console.log("Can't connect to Socket server"+b.message),!1}};f.isLogInCompleted=function(){return c.logInComplete};
f.socketLogin_Completed=function(a,b){try{c.showProgressBar(!1);var d;if(!1!==a.isError.status)console.log("Socket-Server return ERROR: "+a.isError.value),h('<li class="red-frg">Socket Fail...</li>'),alert("Ooops, look like we don't support this page yet..."),c.hubShow(!1);else{"success"===a.login?d="<li>Login completed for "+a.user.nick+"</li>":"null"===a.login&&(d="<li>Join completed for "+a.user.nick+"</li>");setUser(a.user);var e={url:document.URL,type:channelType._public,kind:channelKind.text};
isDefine(hubTalk)?p(e,d):w(function(){p(e,d)});loadHub("note-hub",function(a){"ok"===a&&(hubNote||(hubNote=new th.next.NoteHub),hubNote.hubShow(!0))})}}catch(f){console.log("ERROR(LoginHub.socketLogin_Completed())"+f),c.showProgressBar(!1)}};f.checkUserIdentity=function(){try{var a=getCookie(storageNick),b=getCookie(storagePswd);if(isDefine(a)&&isDefine(b)&&""!==a&&""!==b){var d=userId;d.nick=a;d.pwd=b;e("#input-login-nick").val(a);e("#input-login-password").val(b);c._user=d;setTimeout(function(){e(".th-standard-login").css("display",
"none");c.httpLogin(c._user)},600)}else d=readLocalStorageValues(storageNick),isDefine(d)?(e("#input-login-nick").val(d),setTimeout(function(){e("#input-login-password").focus()},600)):setTimeout(function(){e("#input-login-nick").focus()},600)}catch(f){console.log("ERROR(LoginHub.checkLocalStorage())"+f)}};f.initHub=function(){c.commonHub.initHub(c)};f.fromHubToHub=function(a,b){c.commonHub.fromHubToHub(c,a,b)};f.hubShow=function(a){c.commonHub.hubShow(c,a);c.hubStatus=c.hubStatus<statusHub.active?
statusHub.active:c.hubStatus};f.hubRemove=function(){c.commonHub.hubRemove.call(this)};f.showProgressBar=function(a){c.commonHub.showProgressBar(c,a)};f.getHubStatus=function(a){return c.hubStatus};f.onMainMenuAction_Click=function(a){a.preventDefault();c.commonHub.onMainMenuAction_Click(c,a);return!1};f.onBtnLogin_Click=function(a){try{a.preventDefault();var b=getUser();if(null===b){b=userId;b.nick=document.getElementById("input-login-nick").value;if(!isDefine(b.nick)||""===b.nick)return!1;b.pwd=
document.getElementById("input-login-password").value;if(!isDefine(b.pwd)||""===b.pwd)return alert("And your password is ?"),!1;e(".th-standard-login").css("display","none");n(b);c.httpLogin(b)}else c.socketLogin();return!1}catch(d){return console.log("ERROR(LoginHub.onBtnLogin_Click())"+d),!1}};f.onBtnSignUp_Click=function(a){try{a.preventDefault();var b=getUser(),d={};d.id=GUID();d.online=onlineStatus.online;d.nick=document.getElementById("input-sign-up-nick").value.trim();d.pwd=document.getElementById("input-sign-up-password").value.trim();
d.mail=document.getElementById("input-sign-up-mail").value;d.date=getCurrentDate();d.gender="undefine";d.language="undefine";d.country="undefine";d.hobby=b?b.hobby:"";d.hobbies=b?b.hobbies:[];d.interest="";d.interests=[];d.pic="";d.site="";d.city="";c.pnlSignUP.css("display","none");c.showProgressBar(!0);y(d,function(a){c.showProgressBar(!1);if(a)n(d),isNewUser=!0,c.httpLogin(d);else return c.pnlSignUP.css("display","block"),!1});return!1}catch(e){return console.log("ERROR(LoginHub.onBtnSignUp_Click())"+
e),!1}};f.onLnkNewUser_Click=function(a){try{return a.preventDefault(),c.elServerSide.css("display","none"),e(".th-standard-login").css("display","none"),c.pnlSignUP.css("display","block"),setTimeout(function(){e("#input-sign-up-nick").focus()},600),!1}catch(b){return console.log("ERROR(LoginHub.onLnkNewUser_Click())"+b),!1}};f.onKeepMeLoggedIn_Click=function(){};return g}(thJQ);th.next.LogInController=function(e){function g(){this.Initialize()}g.prototype.Initialize=function(){};return g}(thJQ);
