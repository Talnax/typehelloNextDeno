var th=th||{};th.next=th.next||{};
th.next.NoticeHub=function(b){function u(){a=this;this.cssClassHub=".notice-hub";this.hubStatus=statusHub.not_active;this.noticeCommentTemplate=this.noticeTemplate=this.noticeData=this.userPerClick=null;this.feedbackClass=".notice-hub-dlg-feedback";this.settingsClass=".notice-hub-dlg-settings";this.commonHub=new th.next.CommonHub(this);this.Initialize()}function q(){try{a.showNoticeCommentPanel.removeClass("invisible-item");var c=k();a.showNoticeDlg.find(".th-dlg-show-follow-notice").prop("checked",c);
w(r.show_comment);b("#th-dlg-template-show-notice .th-dlg-title").text("NOTICE COMMENTs");try{isDefine(a.noticeCommentUl)||(a.noticeCommentUl=b("#notice-comment-list-view-ctrl"));a.noticeCommentUl.find("li").remove();for(c=0;c<a.noticeData.comments.length;c++){var d=a.noticeData.comments[c];if(isDefine(d)){var l=d;try{if(isDefine(l)){if(!a.noticeCommentTemplate){var m=b("#notice-item-comment-template").html();a.noticeCommentTemplate=b(m)}if(0!==a.noticeCommentTemplate.length){b(a.noticeCommentTemplate).find(".template-data span").text(JSON.stringify(l.sender));
b(a.noticeCommentTemplate).find(".template-nick span").text(l.sender.nick);b(a.noticeCommentTemplate).find(".template-date span").text(""!==l.date?l.date:"");a.commonHub.setUserIcon(a.noticeCommentTemplate.find(".template-image"),l.sender);b(a.noticeCommentTemplate).find(".template-text span").text(decodeURIComponent(l.comment));var G=a.noticeCommentTemplate[0].outerHTML;a.noticeCommentUl.last().append("<li>"+G+"</li>")}}}catch(g){console.log("ERROR(NoticeHub.bindDataCommentTemplateValues())"+g)}}}a.noticeCommentUl[0].scrollTop=
a.noticeCommentUl[0].scrollHeight}catch(e){console.log("ERROR(NoticeHub.showAllCommentPerNotice()): "+e)}a.noticeCommentPanelInfo=a.showNoticeCommentPanel.find(".notice-comment-info");a.noticeCommentPanelInfo[0<a.noticeData.comments.length?"addClass":"removeClass"]("invisible-item")}catch(f){console.log("NoticeHub.showAddCommentToNoticeDlg(): "+f)}}function g(c){try{c.preventDefault();var d=a.addNoticeCommentDlg.find(".th-dlg-notice-comment-text").val();if(6>d.length)return alert("Oops, type some comment, more then 6 characters !"),
!1;var b={id:GUID(),sender:getUserId(getUser()),date:getCurrentDate(),comment:encodeURIComponent(removeLineBreaks(d)),title:"",link:"",pic:""};ctrlNotice.addCommentToNotice(a.noticeData,b,function(c){a.noticeData.comments.push(b);q();f()});a.addNoticeCommentDlg.addClass("invisible-item");a.noticeCommentPanelInfo.hasClass("invisible-item")||a.noticeCommentPanelInfo.addClass("invisible-item");return!1}catch(m){return console.log("NoticeHub.addCommentToNotice_Click(): "+m),!1}}function e(c){try{return c.preventDefault(),
a.addNoticeCommentDlg.addClass("invisible-item"),!1}catch(d){return console.log("NoticeHub.closeAddCommentToNoticeDlg_Click(): "+d),!1}}function f(){try{var c=[];1===a.noticeData.follow_responses&&c.push(a.noticeData.sender.id);for(var d=0;d<a.noticeData.followers_comments.length;d++){var b=a.noticeData.followers_comments[d].id;0>c.indexOf(b)&&c.push(b)}if(!(1>c.length)){var m=" add new comment of Notice - '"+a.noticeData.title+"'";sendMailToUsersID(getUser(),c,"TypeHello notification",decodeURIComponent(removeLineBreaks(m)),
mailNotificationType.notice,mailContentType.html,function(){})}}catch(g){console.log("NoticeHub.checkFollowsUsers(): "+g)}}function h(){try{var c=b(this).prop("checked")?1:0,d=k()?1:0;c!==d&&(s(!0),1===c?ctrlNotice.addFollowerOfNoticeComments(a.noticeData,function(c){null!==c&&(a.noticeData.followers_comments.push(getUserId(getUser())),s(!1))}):ctrlNotice.removeFollowerOfNoticeComments(a.noticeData,function(c){if(null!==c){for(c=0;c<a.noticeData.followers_comments.length;c++)if(a.noticeData.followers_comments[c].id===
getUser().id){a.noticeData.followers_comments.splice(c,1);break}s(!1)}}))}catch(l){console.log("NoticeHub.onFollowerToComments_Click(): "+l)}}function k(){try{for(var c=0;c<a.noticeData.followers_comments.length;c++)if(a.noticeData.followers_comments[c].id===getUser().id)return!0;return!1}catch(d){return console.log("NoticeHub.isUserFollowerOfComments(): "+d),!1}}function p(c){try{return c.preventDefault(),a.showNoticeCommentPanel.hasClass("invisible-item")?a.showNoticeDlg.hasClass("invisible-item")||
(a.showNoticeDlg.addClass("invisible-item"),w(r.close_show_notice),a.noticeData=null):(a.showNoticeCommentPanel.addClass("invisible-item"),w(r.close_show_comment),b("#th-dlg-template-show-notice .th-dlg-title").text("SHOW NOTICE")),!1}catch(d){return console.log("NoticeHub.onCloseAddNoticeDlg_Click(): "+d),!1}}function y(c){try{c.preventDefault();var d=a.sendNoticeSMSDlg.find(".th-dlg-notice-sms-text").val();if(6>d.length)return alert("Oops, type some message, more then 6 characters !"),!1;s(!0);
A();loadHub("sms-hub",function(c){"ok"===c&&(ctrlSms||(ctrlSms=new th.next.SmsController),ctrlSms.addSms(getUser(),a.noticeData.sender,d,function(a,c,d){s(!1)},function(a,c,d){s(!1)}))});return!1}catch(b){return console.log("NoticeHub.sendNoticeSMS_Click(): "+b),!1}}function H(a){try{return a.preventDefault(),A(),!1}catch(d){return console.log("NoticeHub.closeSendNoticeSMSDlg_Click(): "+d),!1}}function A(){try{a.sendNoticeSMSDlg.find(".th-dlg-notice-sms-text").val(""),a.sendNoticeSMSDlg.addClass("invisible-item")}catch(c){console.log("NoticeHub.closeSMSDlg(): "+
c)}}function s(c){try{c?a.showNoticeDlg.find(".th-notice-progress").removeClass("invisible-item"):a.showNoticeDlg.find(".th-notice-progress").addClass("invisible-item")}catch(d){console.log("NoticeHub.showNoticeProgressBar(): "+d)}}function I(a){try{return a.preventDefault(),B(),!1}catch(d){return console.log("NoticeHub.closeBanDlg_Click(): "+d),!1}}function B(){try{a.sendBanDlg.find(".th-dlg-notice-ban-text").val(""),a.sendBanDlg.addClass("invisible-item")}catch(c){console.log("NoticeHub.closeBanDlg(): "+
c)}}function J(c){try{c.preventDefault();var d=a.showNoticeDlg.find(".th-dlg-notice-ban-text").val();if(9>d.length)return alert("Oops, type some explanation of ban, more then 9 characters !"),!1;var b={id:GUID(),sender:getUserId(getUser()),date:getCurrentDate(),ban:encodeURIComponent(removeLineBreaks(d))};B();s(!0);ctrlNotice.addBanToNotice(a.noticeData,b,function(c){a.noticeData.bans.push(b);s(!1)});return!1}catch(m){return console.log("NoticeHub.sendNoticeBan_Click(): "+m),!1}}function K(c){try{c.preventDefault();
var d=a.addNoticeDlg.find(".th-dlg-add-notice-image").val();if(isDefine(d)&&""!==d)return!1;v(null,c.target.value,a.addNoticeDlg.find(".th-dlg-image-panel"));return!1}catch(b){return console.log("NoticeHub.onChangeNoticeCategory_Click(): "+b),!1}}function L(c){try{return c.preventDefault(),a.addNoticeDlg.addClass("invisible-item"),!1}catch(d){return console.log("NoticeHub.onCloseAddNoticeDlg_Click(): "+d),!1}}function M(c){try{c.preventDefault();var d=c.target.getAttribute("data-action");if("function"===
typeof a[d])a[d]();return!1}catch(b){return console.log("NoticeHub.onNoticeMainMenu_Click(): "+b),!1}}function N(c){try{c.preventDefault();var d=function(c){try{if(c)C(!0),a.addNoticeDlg.find(".btn-circle").css("display","none");else{C(!1);a.addNoticeDlg.addClass("invisible-item");a.addNoticeDlg.find(".btn-circle").css("display","block");c=[".th-dlg-add-notice-city",".th-dlg-add-notice-title",".th-dlg-add-notice-content",".th-dlg-add-notice-tags"];for(var d=0;d<c.length;d++)a.addNoticeDlg.find(c[d]).val("")}}catch(b){console.log("NoticeHub.onAddPostNotice_Click().showProgressBar(): "+
b)}},b=O();if(!isDefine(b))return!1;d(!0);ctrlNotice.addNotice(b,function(a,c,m){ctrlNotice.listNotices.push(b);d(!1);z()},function(a,c,b){d(!1)});return!1}catch(m){return console.log("NoticeHub.onAddPostNotice_Click(): "+m),!1}}function C(c){try{c?a.addNoticeDlg.find(".th-notice-progress").removeClass("invisible-item"):a.addNoticeDlg.find(".th-notice-progress").addClass("invisible-item")}catch(d){console.log("NoticeHub.showAddNoticeProgressBar(): "+d)}}function O(){try{var c={};c.country=t(".th-dlg-add-notice-country").toLowerCase();
c.category=t(".th-dlg-add-notice-category").toLowerCase();c.city=t(".th-dlg-add-notice-city");c.pic=t(".th-dlg-add-notice-image");c.link="";c.id=GUID();c.date=getCurrentDate();c.sender=getUserId(getUser());c.sender.language=getUser().language;c.comments=[];c.bans=[];c.follow_responses=a.addNoticeDlg.find(".th-dlg-add-notice-response").prop("checked")?1:0;c.followers_comments=[];c.title=t(".th-dlg-add-notice-title");if(""===c.title)return alert("Hey, you can't post -notice- without title"),null;c.content=
t(".th-dlg-add-notice-content");if(""===c.content)return alert("Hey, you can't post -notice- without content"),null;c.tags=t(".th-dlg-add-notice-tags").toLowerCase();return""===c.tags?(alert("Hey, you can't post -notice- without tags"),null):c}catch(d){return console.log("ERROR(NoticeHub.getNoticeContent()): "+d),null}}function t(c){c=a.addNoticeDlg.find(c).val().trim();return encodeURIComponent(removeLineBreaks(c))}function D(a){try{a.preventDefault();var d=b(".notice-hub .search-notices"),l={"notice.country":b(d).find(".th-select-notice-country").val().toLowerCase(),
"notice.category":b(d).find(".th-select-notice-category").val().toLowerCase(),"notice.city":encodeURIComponent(removeLineBreaks(b("#input-notice-state-city").val()))},m;for(m in l)if(l.hasOwnProperty(m)){var g=l[m];2>g.length?delete l[m]:"all"===g&&delete l[m]}var e=b("#input-search-notices-tags").val().toLowerCase();if(""===e&&"{}"===JSON.stringify(l))return!1;a="";if(""!==e)for(a=e.replace(","," ").split(" "),e=0;e<a.length;e++)""===a[e]&&searchSplit.splice(e,1);P(l,a);return!1}catch(f){return console.log("ERROR(NoticeHub.onSearchNotice_Click()): "+
f),!1}}function P(c,d){try{a.showProgressBar(!0),ctrlNotice.findNotice(c,d,function(c){if(isJsonData(c)&&(c=JSON.parse(c),isDefine(c.param)&&0<c.param.length)){ctrlNotice.listNotices=[];for(var d=0;d<c.param.length;d++)ctrlNotice.listNotices.push(c.param[d]);z()}a.showProgressBar(!1)})}catch(b){console.log("ERROR(NoticeHub.searchRoutine()): "+b)}}function Q(c){try{c.preventDefault();var d=b(c.target).text();if("COMMENTs"===d)q();else if("ADD COMMENT"===d)try{a.addNoticeCommentDlg.find(".th-template-nick").text(getUser().nick),
a.addNoticeCommentDlg.find(".th-dlg-notice-comment-text").val(""),a.addNoticeCommentDlg.find(".th-dlg-title").text("ADD COMMENT"),a.addNoticeCommentDlg.removeClass("invisible-item")}catch(e){console.log("NoticeHub.showAddCommentToNoticeDlg(): "+e)}else if("SMS"===d)try{a.sendNoticeSMSDlg.find(".th-template-nick").text(getUser().nick),a.addNoticeCommentDlg.find(".th-dlg-notice-sms-text").val(""),a.sendNoticeSMSDlg.removeClass("invisible-item")}catch(g){console.log("NoticeHub.showSMSDlg(): "+g)}else if("BAN"===
d)try{a.sendBanDlg.find(".th-template-nick").text(getUser().nick),a.sendBanDlg.removeClass("invisible-item")}catch(f){console.log("NoticeHub.showSMSDlg(): "+f)}return!1}catch(h){return console.log("NoticeHub.onShowNoticeDlgClick_Click(): "+h),!1}}function E(c){try{c.preventDefault();var d=a.addNoticeDlg.find(".th-dlg-add-notice-category").val().toLowerCase(),b=a.addNoticeDlg.find(".th-dlg-add-notice-image").val();v(b,d,a.addNoticeDlg.find(".th-dlg-image-panel"));return!1}catch(e){return console.log("ERROR(NoticeHub.onNoticeImage_Enter()): "+
e),!1}}function R(a){try{var d=a.target;a.preventDefault();b(d).val();var e=b(d).text(),g=b(".notice-hub .th-expander-region-filter-content");"-"===e?(g.css("display","none"),b(d).html("+")):"+"===e&&(g.css("display","block"),b(d).html("-"));return!1}catch(f){return console.log("ERROR(NoticeHub.onNoticeExpander_Click()): "+f),!1}}function S(c){try{c.preventDefault();var d=c.target.getAttribute("data-action");if("function"===typeof a[d])a[d]();return!1}catch(b){return console.log("ERROR(NoticeHub.onNoticeMenu_Click()): "+
b),!1}}function T(c){try{c.preventDefault();var d=b(c.target).closest(".notice-list-view-item-template").find(".template-data span").text(),e=JSON.parse(d);try{a.noticeData=ctrlNotice.getNoticeById(e);a.userPerClick=a.noticeData.sender;try{v(a.noticeData.pic,decodeURIComponent(a.noticeData.category),a.showNoticeDlg.find(".th-dlg-image-panel")),a.showNoticeDlg.find(".th-dlg-show-notice-nick").text(""!==a.noticeData.sender.nick?a.noticeData.sender.nick:""),a.showNoticeDlg.find(".th-dlg-show-notice-language").text(""!==
a.noticeData.sender.language?a.noticeData.sender.language:""),a.showNoticeDlg.find(".th-dlg-show-notice-gender").text(""!==a.noticeData.sender.gender?a.noticeData.sender.gender:""),a.showNoticeDlg.find(".th-dlg-show-notice-category").text(decodeURIComponent(a.noticeData.category)),a.showNoticeDlg.find(".th-dlg-show-notice-country").text(""!==a.noticeData.country?a.noticeData.country:""),a.showNoticeDlg.find(".th-dlg-show-notice-city").text(decodeURIComponent(a.noticeData.city)),a.showNoticeDlg.find(".th-dlg-show-notice-tags").text(decodeURIComponent(a.noticeData.tags)),
a.showNoticeDlg.find(".th-dlg-show-notice-title").text(decodeURIComponent(a.noticeData.title)),a.showNoticeDlg.find(".th-dlg-show-notice-content").text(decodeURIComponent(a.noticeData.content)),"i can"===a.noticeData.category?a.showNoticeDlg.find(".th-dlg-show-notice-category").css("color","dodgerblue"):a.showNoticeDlg.find(".th-dlg-show-notice-category").css("color","#23a96e")}catch(g){console.log("ERROR(NoticeHub.bindDataShowDlg())"+g)}w(r.show_notice);var f=a.commonHub.getHubZIndex(a);a.showNoticeDlg.find(".th-dlg").css("z-index",
f+1);a.showNoticeDlg.removeClass("invisible-item")}catch(h){console.log("NoticeHub.showNoticeDlg(): "+h)}return!1}catch(p){return console.log("ERROR(NoticeHub.onNoticeItem_Click()): "+p),!1}}function U(){try{a.showNoticeDlg=b("#th-dlg-template-show-notice"),a.showNoticeCommentPanel=a.showNoticeDlg.find(".notice-comment-panel"),a.showNoticeDlgButtons=a.showNoticeDlg.find(".th-notice-show-list-btns"),b(document).on("click","#th-dlg-template-show-notice .th-dlg-show-notice .btn-circle",p),b(document).on("click",
"#th-dlg-template-show-notice ul.th-notice-show-list-btns li div.btn-rect",Q),b(document).on("click","#th-dlg-template-show-notice .th-dlg-show-notice .th-dlg-show-follow-notice",h),a.addNoticeCommentDlg=a.showNoticeDlg.find(".th-dlg-add-comment-to-notice"),b(document).on("click","#th-dlg-template-show-notice .th-dlg-add-comment-to-notice .th-btn-add-notice-comment",g),b(document).on("click","#th-dlg-template-show-notice .th-dlg-add-comment-to-notice .btn-circle",e),a.sendBanDlg=a.showNoticeDlg.find(".th-dlg-add-ban-to-notice"),
b(document).on("click","#th-dlg-template-show-notice .th-dlg-add-ban-to-notice .th-btn-ban-to-notice",J),b(document).on("click","#th-dlg-template-show-notice .th-dlg-add-ban-to-notice .btn-circle",I),a.sendNoticeSMSDlg=a.showNoticeDlg.find(".th-dlg-send-sms-to-notice-owner"),b(document).on("click","#th-dlg-template-show-notice .th-dlg-send-sms-to-notice-owner .th-btn-send-notice-sms",y),b(document).on("click","#th-dlg-template-show-notice .th-dlg-send-sms-to-notice-owner .btn-circle",H),a.addNoticeDlg=
b("#th-dlg-template-add-notice"),a.addNoticeDlg.find(".th-dlg-add-notice-category").change(K),a.addNoticeDlg.find(".th-dlg-add-notice-image").keyup(function(a){13===a.keyCode&&E(a)}),a.addNoticeDlg.find(".th-dlg-add-notice-image").blur(function(a){E(a)}),b(document).on("click","#th-dlg-template-add-notice .th-dlg-add-notice .btn-circle",L),b(document).on("click","#th-dlg-template-add-notice .th-btn-add-notice-post",N),b(document).on("click","#notice-list-view-ctrl li",T),b(document).on("click","#notice-list-view-ctrl li .template-notice-menu span",
S),b(document).on("click",".notice-hub .search-notices .th-expander-sign",R),b(document).on("click",".notice-hub ul.th-ul-main-menu li",M),b("#input-search-notices-tags").keyup(function(a){13===a.keyCode&&D(a)}),b(document).on("click","#btn-input-search-notices",D)}catch(c){console.log("ERROR(NoticeHub.setUIEvents()): "+c)}}function v(a,d,b){try{b.removeClass("th-template-notice-img-can"),b.removeClass("th-template-notice-img-want"),b.removeAttr("style"),isDefine(a)&&""!==a?b.attr("style","background-image: url("+
decodeURIComponent(a)+");"):"i want"===d?b.addClass("th-template-notice-img-want"):b.addClass("th-template-notice-img-can")}catch(e){console.log("ERROR(NoticeHub.setNoticeImage())"+e)}}function w(a){try{a===r.show_notice?x("block"):a===r.show_comment?(F("block"),x("none")):a===r.close_show_notice?x("none"):a===r.close_show_comment&&(F("none"),x("block"))}catch(d){console.log("NoticeHub.onShowNoticeDlgButtons(): "+d)}}function x(c){try{a.showNoticeDlgButtons.find(".th-btn-comment-notice").closest("li").css("display",
c),a.showNoticeDlgButtons.find(".th-btn-ban-notice").closest("li").css("display",c),a.showNoticeDlgButtons.find(".th-btn-sms-notice").closest("li").css("display",c)}catch(d){console.log("NoticeHub.showBttnsNotice(): "+d)}}function F(c){try{a.showNoticeDlgButtons.find(".th-btn-add-comment-notice").closest("li").css("display",c),a.showNoticeDlgButtons.find(".th-dlg-show-follow-notice").closest("li").css("display",c)}catch(d){console.log("NoticeHub.showBttnsComment(): "+d)}}function z(){try{if(a.noticeData=
null,a.noticeTemplate=null,a.noticeCommentTemplate=null,isDefine(a.noticesUl)||(a.noticesUl=b("#notice-list-view-ctrl")),a.noticesUl.find("li").remove(),isDefine(ctrlNotice.listNotices)){for(var c=0;c<ctrlNotice.listNotices.length;c++){var d=ctrlNotice.listNotices[c];try{if(isDefine(d)){if(!a.noticeTemplate){var e=b("#notice-item-template").html();a.noticeTemplate=b(e)}if(0!==a.noticeTemplate.length){b(a.noticeTemplate).find(".template-data span").text(JSON.stringify(d.id));b(a.noticeTemplate).find(".template-date span").text(""!==
d.date?d.date:"");var g=decodeURIComponent(d.category),f=b(a.noticeTemplate).find(".template-notice-category");f.text(decodeURIComponent(d.category));f.css("color","i want"===g?"#23a96e":"dodgerblue");b(a.noticeTemplate).find(".template-notice-title").text(decodeURIComponent(d.title));v(d.pic,g,a.noticeTemplate.find(".template-notice-img"));var h=decodeURIComponent(d.content),h=127<h.length?h.slice(0,127)+"...":h;b(a.noticeTemplate).find(".template-notice-text").text(h);var p=a.noticeTemplate[0].outerHTML;
b("#notice-list-view-ctrl").last().append("<li>"+p+"</li>")}}}catch(k){console.log("ERROR(NoticeHub.bindDataTemplateValues())"+k)}}a.noticesUl[0].scrollTop=a.noticesUl[0].scrollHeight}}catch(y){console.log("ERROR(NoticeHub.showAllNotices())"+y)}}var a,n=u.prototype;n.Initialize=function(){try{a.commonHub.removeMainMenuItem(a,"notice"),this.initHub(),ctrlNotice=new th.next.NoticeController,a.hubStatus=statusHub.initialized,setTimeout(function(){a.readAllNotices()},600),U()}catch(c){console.log("ERROR(NoticeHub.Initialize()): "+
c)}};n.showAddNoticeDlg=function(){try{try{a.addNoticeDlg.find(".th-template-nick").text(getUser().nick);a.addNoticeDlg.find(".th-dlg-add-notice-response").attr("checked",!1);var c=a.addNoticeDlg.find(".th-dlg-add-notice-category").val().toLowerCase();v(null,c,a.addNoticeDlg.find(".th-dlg-image-panel"));var d=a.commonHub.getHubZIndex(a);a.addNoticeDlg.find(".th-dlg").css("z-index",d+1);a.addNoticeDlg.removeClass("invisible-item")}catch(b){console.log("NoticeHub.showAddNoticeDlg(): "+b)}}catch(e){console.log("ERROR(NoticeHub.showAddNoticeDlg()): "+
e)}};n.readAllNotices=function(){try{a.showProgressBar(!0),ctrlNotice.listNotices=[],ctrlNotice.getNotices(function(c){a.showProgressBar(!1);z()})}catch(c){console.log("ERROR(NoticeHub.readAllNotices()): "+c)}};n.initHub=function(){a.commonHub.initHub(a)};n.onMainMenuAction_Click=function(c){a.commonHub.onMainMenuAction_Click(a,c)};n.fromHubToHub=function(c,b){a.commonHub.fromHubToHub(a,c,b)};n.hubShow=function(c){a.commonHub.hubShow(a,c);a.hubStatus=a.hubStatus<statusHub.active?statusHub.active:
a.hubStatus};n.hubRemove=function(){a.commonHub.hubRemove.call(this)};n.showProgressBar=function(c){a.commonHub.showProgressBar(a,c)};n.getHubStatus=function(c){return a.hubStatus};n.showAboutNoticePanel=function(){try{return event.preventDefault(),!1}catch(a){return console.log("ERROR(NoticeHub.showAboutNoticePanel()): "+a),!1}};var r={show_notice:1,close_show_notice:2,show_comment:3,close_show_comment:4};return u}(thJQ);
th.next.NoticeController=function(b){function u(){q=this;this.listNotices=[];this.Initialize()}var q;b=u.prototype;b.Initialize=function(){};b.getNotices=function(b){try{var e=JSON.stringify({dbcall:"db-get",dbcollection:"notices",dbrequest:{},dblimit:{limit:18}});ajaxCall(pathServer+"get-n-last-notices","get-n-last-notices="+e,function(e,f,p){if(isJsonData(e)&&(e=JSON.parse(e),"object"===typeof e.param)){for(f=0;f<e.param.length;f++)q.listNotices.push(e.param[f].notice);sendCallBack(b(!0));return}sendCallBack(b(!1))},
function(e,f,p){console.log("ERROR[NoticeController.getNotices()]: "+p);sendCallBack(b(!1))})}catch(f){console.log("ERROR(NoticeController.getNotices()): "+f)}};b.addNotice=function(b,e,f){try{if(isDefine(b)){var h=JSON.stringify({dbcall:"db-add",dbcollection:"notices",dbrequest:{notice:b}});ajaxCall(pathServer+"add-notice","add-notice="+h,e,f)}}catch(k){console.log("ERROR(NoticeController.addNotice()): "+k)}};b.addBanToNotice=function(b,e,f){try{if(isDefine(b)&&isDefine(e)&&isDefine(f)){var h=JSON.stringify({notice_id:b.id,
ban:e});ajaxCall(pathServer+"add-ban-to-notice","add-ban-to-notice="+h,function(b,e,g){sendCallBack(f(!0))},function(b,e,g){console.log("ERROR[NoticeController.addBanToNotice()]: "+g);sendCallBack(f(!1))})}}catch(k){console.log("ERROR(NoticeController.addBanToNotice()): "+k)}};b.addCommentToNotice=function(b,e,f){try{if(isDefine(b)&&isDefine(e)&&isDefine(f)){var h=JSON.stringify({notice_id:b.id,comment:e});ajaxCall(pathServer+"add-comment-to-notice","add-comment-to-notice="+h,function(b,e,g){isJsonData(b)?
(b=JSON.parse(b),sendCallBack(f(!b.err))):sendCallBack(f(!1))},function(b,e,g){console.log("ERROR[NoticeController.addCommentToNotice()]: "+g);sendCallBack(f(!1))})}}catch(k){console.log("ERROR(NoticeController.addCommentToNotice()): "+k)}};b.addFollowerOfNoticeComments=function(b,e){try{if(isDefine(b)&&isDefine(e)){var f={notice_id:b.id,follower:getUserId(getUser())},h=JSON.stringify(f);ajaxCall(pathServer+"add-follower-of-notice-comments","add-follower-of-notice-comments="+h,function(b,f,g){sendCallBack(e(b))},
function(b,f,g){sendCallBack(e(null))})}}catch(k){console.log("ERROR(NoticeController.addCommentToNotice()): "+k)}};b.removeFollowerOfNoticeComments=function(b,e){try{if(isDefine(b)&&isDefine(e)){var f={notice_id:b.id,follower:getUserId(getUser())},h=JSON.stringify(f);ajaxCall(pathServer+"remove-follower-of-notice-comments","remove-follower-of-notice-comments="+h,function(b,f,g){sendCallBack(e(b))},function(b,f,g){sendCallBack(e(null))})}}catch(k){console.log("ERROR(NoticeController.addCommentToNotice()): "+
k)}};b.findNotice=function(b,e,f){try{if(isDefine(b)&&isDefine(e)){var h=JSON.stringify({dbcall:"db-find",dbcollection:"notices",filter:b,tags:e});ajaxCall(pathServer+"find-notice","find-notice="+h,function(b,e,g){sendCallBack(f(b))},function(b,e,g){sendCallBack(f(null))})}}catch(k){console.log("ERROR(NoticeController.findNotice()): "+k)}};b.updateNotice=function(b,e,f,h){try{if(isDefine(b)&&isDefine(e)){var k={dbcall:"db-update",dbcollection:"notices",dbrequest:{user:getUserId(b),notice:e}},p=JSON.stringify(k);
ajaxCall(pathServer+"update-notice","update-notice="+p,f,h)}}catch(q){console.log("ERROR(NoticeController.updateNotice()): "+q)}};b.getNoticeById=function(b){try{if(!isDefine(b))return null;for(var e=0;e<q.listNotices.length;e++){var f=q.listNotices[e];if(f.id===b)return f}return null}catch(h){return console.log("ERROR(NoticeController.getNoticeById()): "+h),null}};return u}(thJQ);
