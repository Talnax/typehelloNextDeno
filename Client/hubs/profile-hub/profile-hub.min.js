var th=th||{};th.next=th.next||{};
th.next.ProfileHub=function(d){function k(){a=this;this.cssClassHub=".profile-hub";this.hubStatus=statusHub.not_active;this.userImageData=this.activeExpander=null;this.feedbackClass=".profile-hub-dlg-feedback";this.settingsClass=".profile-hub-dlg-settings";this.commonHub=new th.next.CommonHub(this);this.Initialize()}function q(c){try{c.preventDefault();var b=function(c,b,e){isJsonData(c)&&(JSON.parse(c),a.showProgressBar(!1),a.hubShow(!1))},e=getUser(),d=w(e);if(!isDefine(d))return!1;var f={dbcall:"db-update",
dbcollection:"users",dbfind:{id:e.id,nick:e.nick},dbupdate:{$set:d}};setTimeout(function(){ctrlProfile.updateFullProfile(e,f,b,function(c,b,e){a.showProgressBar(!1);console.log("ERROR[ProfileHub->ctrlProfile.getFullProfile()]: "+e);a.hubShow(!1)})},600);a.showProgressBar(!0);return!1}catch(g){return console.log("ERROR(ProfileHub.onSubmitProfile_Click()): "+g),a.showProgressBar(!1),!1}}function n(a){try{return a.preventDefault(),r(p.recommended),!1}catch(b){return console.log("ERROR(ProfileHub.onExpanderRecommended_Click()): "+
b),!1}}function h(a){try{return a.preventDefault(),r(p.extended),!1}catch(b){return console.log("ERROR(ProfileHub.onExpanderExtended_Click()): "+b),!1}}function l(c){try{c.preventDefault();var b=event.target.value;m(a.setGender,b);var e=""===a.elPic.val()?"":a.elPic.val();a.commonHub.setUserIcon(a.userPic,{gender:b,pic:e});return!1}catch(d){return console.log("ERROR(ProfileHub.onSelectGender_Click()): "+d),!1}}function s(c){try{c.preventDefault();var b=event.target.value;m(a.setCountry,b);a.setCountry.text(b);
return!1}catch(e){return console.log("ERROR(ProfileHub.onSelectCountry_Click()): "+e),!1}}function t(c){try{c.preventDefault();var b=event.target.value;m(a.setLanguage,b);a.setLanguage.text(b);return!1}catch(e){return console.log("ERROR(ProfileHub.onSelectLanguage_Click()): "+e),!1}}function x(a){try{a.preventDefault();var b;b="recommended-info"===d(this).attr("data-action")?"Those info help you be more transparent, set your online picture, language and country":"Additional information give you chance, find another persons with same interest like you.<br><br>Also say few word about your hobbies and share passion of your site, if you have one :)";
u(b);return!1}catch(e){return console.log("ERROR(NoticeHub.onBtnInfo_Click()): "+e),!1}}function y(){try{a.elPic=d("#th-profile-picture"),a.elPic.blur(function(c){try{c.preventDefault();var e=c.target.value,d={gender:getUser().gender,pic:e};a.commonHub.setUserIcon(a.userPic,d)}catch(f){console.log("ERROR(NoticeHub.onProfileImage_Enter()): "+f)}}),d(document).on("click",".profile-hub .th-article-expander-block .th-glyph",x),d("#btn-submit-profile").click(q),d("#btn-expander-recommended").click(n),
d("#btn-expander-extended").click(h),d("#th-profile-gender").change(l),d("#th-profile-country").change(s),d("#th-profile-language").change(t)}catch(c){console.log("ERROR(ProfileHub.setUIEvents()): "+c)}}function u(c){a.commonHub.showInfoDlg(a,".profile-hub-dlg-info",c,function(a){})}function r(c){try{isDefine(c)&&(a.expRecommended.css("display","none"),a.expExtended.css("display","none"),a.btnExtended.removeClass("special"),a.btnRecommended.removeClass("special"),a.activeExpander===c?a.activeExpander=
null:(a.activeExpander=c,c===p.recommended?(a.expRecommended.css("display","block"),a.btnRecommended.addClass("special"),a.btnExtended.removeClass("special")):(a.expExtended.css("display","block"),a.btnExtended.addClass("special"),a.btnRecommended.removeClass("special"))))}catch(b){console.log("ERROR(ProfileHub.setActiveExpander()): "+b)}}function m(a,b){try{if(isDefine(a)&&isDefine(b)){a.text(b);try{if(isDefine(a)&&isDefine(b))try{"undefine"===b?a[0].setAttribute("style","color: red"):a[0].removeAttribute("style")}catch(e){console.log("ERROR(ProfileHub.setAlertColor()): "+
e)}}catch(d){console.log("ERROR(ProfileHub.checkUndefine()): "+d)}}}catch(f){console.log("ERROR(ProfileHub.setStandardValue()): "+f)}}function v(c){try{isDefine(a.userPic)||(a.userPic=d(".profile-hub .th-section .user-profile-picture")),a.commonHub.setUserIcon(a.userPic,c)}catch(b){console.log("ERROR(setProfilePic()): "+b)}}function z(c){try{var b=function(b,e,g){a.hubStatus=statusHub.data_loaded;a.showProgressBar(!1);try{if(isJsonData(b)){c=JSON.parse(b).param[0];b=c;try{isDefine(b)&&(a.elPic.val(isDefine(b.pic)?
decodeURIComponent(b.pic):""),d("#th-profile-city").val(isDefine(b.city)?decodeURIComponent(b.city):""),d("#th-profile-site").val(isDefine(b.site)?decodeURIComponent(b.site):""),d("#th-profile-about-me").text(isDefine(b.about_me)?decodeURIComponent(b.about_me):""),d("#th-profile-hobbies").text(isDefine(b.hobby)?decodeURIComponent(b.hobby):""),d("#th-profile-interests").text(isDefine(b.interests)?decodeURIComponent(b.interests):""))}catch(h){console.log("ERROR(ProfileHub.bindFullProfile()): "+h)}}}catch(q){console.log("FAIL-PARSING[ProfileHub->ctrlSms.getFullProfile()]: "+
q),a.hubStatus=statusHub.data_loaded_err}},e=function(b,c,e){console.log("ERROR[ProfileHub->ctrlProfile.getFullProfile()]: "+e);a.showProgressBar(!1);a.hubStatus=statusHub.data_loaded_err};setTimeout(function(){ctrlProfile.getFullProfile(c,b,e)},600);a.showProgressBar(!0)}catch(g){console.log("ERROR(ProfileHub.reloadProfile()): "+g),a.showProgressBar(!1)}}function w(c){try{var b;try{var e={};e.gender=encodeURIComponent(removeLineBreaks(d("#th-profile-gender").val()));e.country=encodeURIComponent(removeLineBreaks(d("#th-profile-country").val()));
e.language=encodeURIComponent(removeLineBreaks(d("#th-profile-language").val()));e.city=encodeURIComponent(removeLineBreaks(d("#th-profile-city").val()));e.site=encodeURIComponent(removeLineBreaks(d("#th-profile-site").val()));e.hobby=encodeURIComponent(removeLineBreaks(d("#th-profile-hobbies").val()));e.hobbies=e.hobby.split("%2C");e.interest=encodeURIComponent(removeLineBreaks(d("#th-profile-interests").val()));e.interests=e.interest.split("%2C");e.pic=encodeURIComponent(removeLineBreaks(a.elPic.val().trim()));
b=e}catch(g){console.log("ERROR(ProfileHub.getReadWriteProfileValues()): "+g),b=null}var e=null,f;for(f in b)c.hasOwnProperty(f)&&b.hasOwnProperty(f)?c[f]!==b[f]&&(null===e&&(e={}),e[f]=b[f],c[f]=b[f]):(null===e&&(e={}),e[f]=b[f],c[f]=b[f]);isDefine(b.pic)&&b.pic!==c.pic&&(c.pic=b.pic,setUser(c),v(c));return e}catch(h){return console.log("ERROR(ProfileHub.getUpdatedRequest()): "+h),null}}var a,g=k.prototype,p={required:0,recommended:1,extended:2};g.Initialize=function(){try{ctrlProfile||(ctrlProfile=
new th.next.ProfileController),a.commonHub.removeMainMenuItem(a,"profile"),this.initHub(),a.commonHub.setHubPosition(a),a.setLanguage=d("#th-read-lng"),a.setCountry=d("#th-read-country"),a.setGender=d("#th-read-gender"),a.expRecommended=d(".th-profile-recommended"),a.expExtended=d(".th-profile-extended"),a.btnRecommended=d("#btn-expander-recommended"),a.btnExtended=d("#btn-expander-extended"),y(),a.hubStatus=statusHub.initialized}catch(c){console.log("ERROR(ProfileHub.Initialize()): "+c)}};g.showFullProfile=
function(c){try{if(isDefine(c)&&!(a.hubStatus>=statusHub.load_data)){try{isDefine(c)&&(d("#th-read-nick").text(c.nick),m(a.setLanguage,c.language),m(a.setCountry,c.country),m(a.setGender,c.gender))}catch(b){console.log("ERROR(ProfileHub.showMinimumProfile()): "+b)}try{isDefine(c)&&(d("#th-profile-gender").val(c.gender.toLowerCase()),d("#th-profile-country").val(c.country.toLowerCase()),d("#th-profile-language").val(c.language.toLowerCase()),v(c))}catch(e){console.log("ERROR(ProfileHub.showRecommendedProfile()): "+
e)}z(c)}}catch(g){console.log("ERROR(ProfileHub.showFullProfile()): "+g)}};g.showFirstTime=function(c){try{a.showFullProfile(c),r(p.recommended),setTimeout(function(){var a="<span class='th-bold th-font-18'>Hello "+getUser().nick+"</span> !<br><br>A little advise, just spend less than <span class='th-bold th-font-18'>15</span> seconds for filling your profile.<br><br>In this case people can see you and share news and interests.<br><br>- TypeHello Team :)";u(a)},600)}catch(b){console.log("ERROR(ProfileHub.showFullProfile()): "+
b)}};g.initHub=function(){a.commonHub.initHub(a)};g.onMainMenuAction_Click=function(c){a.commonHub.onMainMenuAction_Click(a,c)};g.fromHubToHub=function(c,b){a.commonHub.fromHubToHub(a,c,b)};g.hubShow=function(c){a.commonHub.hubShow(a,c);a.hubStatus=a.hubStatus<statusHub.active?statusHub.active:a.hubStatus};g.hubRemove=function(){a.commonHub.hubRemove.call(this)};g.showProgressBar=function(c){a.commonHub.showProgressBar(a,c)};g.getHubStatus=function(c){return a.hubStatus};return k}(thJQ);
th.next.ProfileController=function(d){function k(){this.Initialize()}d=k.prototype;d.Initialize=function(){};d.getFullProfile=function(d,n,h){try{if(isDefine(d)&&isDefine(n)&&isDefine(h)){var l=JSON.stringify({dbcall:"db-find",dbcollection:"users",dbrequest:{id:d.id}});ajaxCall(pathServer+"get-full-profile","get-full-profile="+l,n,h)}}catch(k){console.log("ERROR(): "+k)}};d.updateFullProfile=function(d,k,h,l){try{if(isDefine(d)&&isDefine(h)&&isDefine(l)){var s=JSON.stringify(k);ajaxCall(pathServer+
"update-full-profile","update-full-profile="+s,h,l)}}catch(t){console.log("ERROR(ProfileController.updateFullProfile()): "+t)}};return k}(thJQ);
