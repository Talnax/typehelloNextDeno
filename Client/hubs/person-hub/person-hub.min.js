var th=th||{};th.next=th.next||{};
th.next.PersonHub=function(b){function n(){a=this;this.cssClassHub=".person-hub";this.hubStatus=statusHub.not_active;this.indexActiveUser=-1;this.arrayPersons=[];this.statusList=this.activeAnimation=this.userPerClick=this.usrTemplate=null;this.feedbackClass=".person-hub-dlg-feedback";this.commonHub=new th.next.CommonHub(this);this.Initialize()}function m(c){try{c.preventDefault();var p=b(this).val();f();for(c=0;c<a.arrayPersons.length;c++)a.arrayPersons[c].status===p?e(c,a.arrayPersons[c]):"all"===
p&&e(c,a.arrayPersons[c]);return!1}catch(d){return console.log("ERROR(PersonHub.onPersonStatus_Select()): "+d),!1}}function h(c){try{c.preventDefault();var b=c.target.getAttribute("data-action");a.userPerClick=null;a.userPerClick=getUserPerDataTemplate("person-list-view-item-template",c);switch(b){case "sms":a.commonHub.showSmsDlg(a,".show-dlg-sms",function(){});break;case "talk":a.showProgressBar(!0);ctrlPerson.getSocketIDByUserID(a.userPerClick,function(c){a.showProgressBar(!1);null===c?a.commonHub.showInfoDlg(a,
".person-hub-dlg-info","You can't talk with "+a.userPerClick.nick+". This person offline :(",function(a){}):(a.userPerClick.socket_id=c,hubTalk.buildPrivateChannel(getUser(),a.userPerClick))});break;case "profile":a.commonHub.showProfileDlg(a,".show-dlg-profile",function(){})}return!1}catch(d){return console.log("ERROR(PersonHub.onUser_Click()): "+d),!1}}function d(c){try{c.preventDefault();var d=b(this);a.userPerClick=null;a.userPerClick=getUserPerDataTemplate("person-list-view-item-template",c);
a.indexActiveUser=k();var e=function(){a.activeAnimation=d;a.activeAnimation.id=a.userPerClick.id;a.activeAnimation.user=a.userPerClick};null!==a.activeAnimation?g(a.activeAnimation,!1,function(){a.activeAnimation.id!==a.userPerClick.id?g(d,!0,function(){e()}):a.activeAnimation=null}):g(d,!0,function(){e()});return!1}catch(h){return console.log("ERROR(PersonHub.onUser_Click()): "+h),!1}}function k(){try{for(var c=0;c<a.arrayPersons.length;c++)if(a.arrayPersons[c].id===a.userPerClick.id)return c;return-1}catch(d){return console.log("ERROR(PersonHub.getIndexActiveUser()): "+
d),-1}}function f(){try{b("#person-list-view-ctrl li").remove()}catch(a){console.log("ERROR(PersonHub.cleanUsersPanel()): "+a)}}function e(c,d){try{if(!a.usrTemplate){var e=b("#person-item-template").html();a.usrTemplate=b(e)}if(0!=a.usrTemplate.length){var h=d.person,f=JSON.stringify(h);b(a.usrTemplate).find(".template-data span").text(f);b(a.usrTemplate).find(".template-date span").text(d.date);b(a.usrTemplate).find(".template-nick span").text(h.nick);var g=b(a.usrTemplate).find(".template-image");
a.commonHub.setUserIcon(g,h);var l="<li>"+a.usrTemplate[0].outerHTML+"</li>";b("#person-list-view-ctrl").append(l);g[0].removeAttribute("style")}}catch(k){console.log("ERROR(PersonHub.bindUsersDataTemplateValues()): "+k)}}function g(c,d,e){try{d?c.animate({width:"76%",height:"90px"},"fast",function(){var c=b(this).find(".template-nick span");c.css("font-size","12px");c.text(getStrUserShortProfile(a.userPerClick));b(this).find(".btn-circle").css("display","none");b(this).find(".template-image").css("width",
"54px").css("height","54px");b(this).find(".th-person-menu").css("display","block");sendCallBack(e)}):(c.find(".th-person-menu").css("display","none"),c.animate({width:"78px",height:"69px"},"fast",function(){var a=b(this).find(".template-nick span");a.text(c.user.nick);a.css("font-size","13px");b(this).find(".btn-circle").css("display","block");b(this).find(".template-image").css("width","45px").css("height","45px");sendCallBack(e)}))}catch(h){console.log("ERROR(PersonHub.animatePersonItem()): "+
h)}}var a,l=n.prototype;l.Initialize=function(){try{isDefine(ctrlPerson)||(ctrlPerson=new th.next.PersonController);a.commonHub.removeMainMenuItem(a,"friends");this.initHub();b(document).on("click",".person-list-view-item-template",d);b(document).on("click",".person-list-view-item-template li.th-person-menu-item",h);try{a.statusList=b(".th-select-person-status");a.statusList.change(m);var c=document.createElement("option");c.innerHTML="all";c.value="all";a.statusList[0].appendChild(c);for(var e in personStatus)if(personStatus.hasOwnProperty(e)){var f=
document.createElement("option");f.innerHTML=e;f.value=e;a.statusList[0].appendChild(f)}}catch(g){console.log("ERROR(PersonHub.feelSelectStatusList()): "+g)}a.commonHub.setHubPosition(a);a.hubStatus=statusHub.initialized}catch(l){console.log("ERROR(PersonHub.Initialize()): "+l)}};l.readAllPersons=function(c){try{if(isDefine(c)){f();a.statusList.val("all");var d=function(c,d,b){a.showProgressBar(!1);a.hubStatus=statusHub.data_loaded;try{if(isJsonData(c)){var h=JSON.parse(c);a.indexActiveUser=-1;a.arrayPersons=
null;a.arrayPersons=[];if("object"===typeof h.param){a.arrayPersons=h.param;for(c=0;c<a.arrayPersons.length;c++)e(c,a.arrayPersons[c]);return}}a.commonHub.showInfoDlg(a,".person-hub-dlg-info","You don't have any -friends- yet",function(a){})}catch(f){console.log("FAIL-PARSING[PersonHub->ctrlPerson.readAllPersons()]: "+f),a.hubStatus=statusHub.data_loaded_err}},b=function(c,d,e){console.log("ERROR[PersonHub->ctrlPerson.readAllPersons()]: "+e);a.showProgressBar(!1);a.hubStatus=statusHub.data_loaded_err};
setTimeout(function(){ctrlPerson.readPersons(c,d,b)},600);a.showProgressBar(!0)}}catch(h){console.log("ERROR(PersonHub.readAllPersons()): "+h)}};l.personNotificationCompleted=function(a){try{confirm(a.msg+"\n"+("male"===a.user.gender?"Make him ":"Make here ")+a.status+" too?")||(a.status="fellow"),ctrlPerson.addPerson(getUser(),a.person,a.status,function(a,c,d){},function(a,c,d){console.log("ERROR[TalkHub->ctrlPerson.addPerson()]: "+d)})}catch(d){console.log("ERROR(PersonHub.personNotificationCompleted()): "+
d)}};l.initHub=function(){a.commonHub.initHub(a)};l.onMainMenuAction_Click=function(c){a.commonHub.onMainMenuAction_Click(a,c)};l.fromHubToHub=function(c,d){a.commonHub.fromHubToHub(a,c,d)};l.hubShow=function(c){a.commonHub.hubShow(a,c);a.hubStatus=a.hubStatus<statusHub.active?statusHub.active:a.hubStatus};l.hubRemove=function(){a.commonHub.hubRemove.call(this)};l.showProgressBar=function(c){a.commonHub.showProgressBar(a,c)};l.getHubStatus=function(c){return a.hubStatus};return n}(thJQ);
th.next.PersonController=function(b){function n(){m=this;this.listPerson=null;this.Initialize()}var m;b=n.prototype;b.Initialize=function(){};b.readPersons=function(h,d,b){try{if(isDefine(h)&&isDefine(d)&&isDefine(b)){var f={user:getUserId(h)},e=JSON.stringify(f);ajaxCall(pathServer+"get-all-persons-per-user","get-all-persons-per-user="+e,d,b)}}catch(g){console.log("ERROR(PersonController.readPersons()): "+g)}};b.addPerson=function(b,d,k,f,e){try{if(isDefine(b)&&isDefine(d)&&isDefine(k)&&isDefine(f)&&
isDefine(e)){var g=getUserId(b);isDefine(b.pic)&&(g.pic=encodeURIComponent(g.pic));var a=getUserProfile(d);isDefine(a.socket_id)&&delete a.socket_id;isDefine(a.pic)&&(a.pic=encodeURIComponent(a.pic));var l=getCurrentDate(),c=JSON.stringify({user:g,date:l,person:{person:a,status:k,date:l}});ajaxCall(pathServer+"add-person-per-user","add-person-per-user="+c,f,e)}}catch(m){console.log("ERROR(PersonController.AddPerson()): "+m)}};b.removePerson=function(b,d,k,f){try{if(isDefine(b)&&isDefine(d)&&isDefine(k)&&
isDefine(f)){var e=JSON.stringify({user:{id:b.id},person:{id:d.id}});ajaxCall(pathServer+"remove-person-per-user","remove-person-per-user="+e,k,f)}}catch(g){console.log("ERROR(PersonController.removePerson()): "+g)}};b.isPersonOfUser=function(b,d,k,f,e){try{if(isDefine(b)&&isDefine(d)&&isDefine(k)&&isDefine(f)&&isDefine(e)){var g=JSON.stringify({user:{id:b.id},person:{id:d.id}});ajaxCall(pathServer+"is-person-of-user","is-person-of-user="+g,f,e)}}catch(a){console.log("ERROR(PersonController.isPersonOfUser()): "+
a)}};b.isPersonOfUserCallback=function(b,d,k,f){try{if(isDefine(b)&&isDefine(d)&&isDefine(k)){var e=JSON.stringify({user:{id:b.id},person:{id:d.id}});ajaxCall(pathServer+"is-person-of-user","is-person-of-user="+e,function(a,b,c){a=JSON.parse(a);"object"===typeof a?sendCallBack(f(a.param)):sendCallBack(f(-1))},function(a,b,c){sendCallBack(f(-1))})}}catch(g){console.log("ERROR(PersonController.isPersonOfUser()): "+g)}};b.getSocketIDByUserID=function(b,d){try{if(isDefine(b)){var k=JSON.stringify({user:b});
ajaxCall(pathServer+"get-socket-id-by-user-id","get-socket-id-by-user-id="+k,function(b,f,a){b=JSON.parse(b);"object"===typeof b&&null!==b.param?d(b.param):d(null)},function(b,f,a){m.showProgressBar(!1);d(null)})}}catch(f){console.log("ERROR(PersonController.isPersonOfUser()): "+f)}};b.getPersons=function(b,d){try{if(null!==m.listPerson)sendCallBack(d());else{var k=function(a,b,f){try{if(isJsonData(a)){var e=JSON.parse(a);"object"===typeof e.param&&(m.listPerson=[],m.listPerson=e.param)}sendCallBack(d)}catch(g){console.log("FAIL-PARSING[PersonHub->ctrlPerson.getPersons()]: "+
g),sendCallBack(d)}},f=function(a,b,e){console.log("ERROR[PersonHub->ctrlPerson.getPersons()]: "+e);sendCallBack(d)};if(isDefine(b)){var e={user:getUserId(b)},g=JSON.stringify(e);ajaxCall(pathServer+"get-all-persons-per-user","get-all-persons-per-user="+g,k,f)}}}catch(a){console.log("ERROR(PersonController.getPersons()): "+a)}};return n}(thJQ);
